name: syllabus-tracker-dev
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    ports:
      - "8000:8000"
    env_file:
      - config/common.env
      - config/dev.env
      - .secrets.env
    volumes:
      - ./:/usr/src/app
      - target-cache:/usr/src/app/target
    depends_on:
      - otel-collector
    networks:
      - syllabus-net

  otel-collector:
    image: otel/opentelemetry-collector:latest
    command: ["--config=/etc/otel-collector-config.yaml"]
    volumes:
      - ./config/otel-collector-config.yaml:/etc/otel-collector-config.yaml
    env_file:
      - config/common.env
      - config/dev.env
      - .secrets.env
    ports:
      - "4317:4317"   # OTLP gRPC
      - "4318:4318"   # OTLP HTTP
    networks:
      - syllabus-net

networks:
  syllabus-net:
      name: syllabus-tracker-dev_syllabus-net

volumes:
  target-cache:
